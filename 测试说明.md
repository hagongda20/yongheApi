# Flask 服务测试说明

## 🔍 问题排查

### 1. 关于"打印两遍"

这是 **正常现象**！Flask 的 debug 模式会：
1. 第一次启动（加载代码）
2. 自动重启一次（"Restarting with stat"）- 这是为了监控文件变化

**解决方法**: 在 `app.run()` 中添加 `use_reloader=False` 可以禁用自动重载。

### 2. 访问不到的问题

#### 检查步骤：

**步骤 1: 确认服务正在运行**
- 看到 "Running on http://127.0.0.1:6000" 表示服务已启动
- 如果看到错误信息，说明启动失败

**步骤 2: 尝试不同的地址**
- ✅ `http://127.0.0.1:6000/` （推荐）
- ✅ `http://localhost:6000/`
- ❌ 不要使用 `http://0.0.0.0:6000/`

**步骤 3: 使用命令行测试**
```powershell
# PowerShell
Invoke-WebRequest -Uri http://127.0.0.1:6000/ -Method GET

# 或者使用 curl（如果安装了）
curl http://127.0.0.1:6000/
```

**步骤 4: 检查防火墙**
- Windows 防火墙可能阻止了连接
- 尝试临时关闭防火墙测试

**步骤 5: 检查浏览器**
- 尝试无痕模式
- 尝试不同的浏览器
- 检查是否使用了代理

## 🧪 测试方法

### 方法 1: 使用改进的测试脚本

```bash
python test_simple_v2.py
```

这个版本：
- 使用 `127.0.0.1` 而不是 `localhost`
- 禁用了自动重载（不会打印两遍）
- 添加了更详细的错误提示

### 方法 2: 使用 Python 直接测试

在另一个终端运行：

```python
import requests
response = requests.get('http://127.0.0.1:6000/')
print(response.json())
```

### 方法 3: 使用浏览器开发者工具

1. 打开浏览器（Chrome/Firefox）
2. 按 F12 打开开发者工具
3. 访问 `http://127.0.0.1:6000/`
4. 查看 Network 标签，看请求是否发送成功
5. 查看 Console 标签，看是否有错误

## 🐛 常见错误

### 错误 1: "无法连接到远程服务器"

**原因**: 服务没有启动或端口被占用

**解决**:
```bash
# 检查端口占用
netstat -ano | findstr :6000

# 如果被占用，找到进程 ID 并结束
taskkill /PID <进程ID> /F
```

### 错误 2: "Connection refused"

**原因**: Flask 服务没有正常启动

**解决**: 检查启动时的错误信息

### 错误 3: 浏览器显示 "无法访问此网站"

**可能原因**:
1. 防火墙阻止
2. 浏览器代理设置
3. 服务实际没有启动

**解决**: 
- 检查终端中是否有 "Running on" 消息
- 尝试使用 `127.0.0.1` 而不是 `localhost`

## ✅ 成功标志

如果一切正常，你应该：

1. **终端显示**:
   ```
   * Running on http://127.0.0.1:6000
   * Debugger is active!
   ```

2. **浏览器访问 `http://127.0.0.1:6000/` 显示**:
   ```json
   {
     "message": "Hello from Flask!",
     "status": "success"
   }
   ```

3. **终端显示请求日志**:
   ```
   127.0.0.1 - - [时间] "GET / HTTP/1.1" 200 -
   ```

## 💡 建议

如果简单脚本能工作，但 `app.py` 不能工作，问题可能在：
1. 数据库连接失败（检查 `db_config.py`）
2. 导入的模块有问题
3. 路由注册有冲突

告诉我测试结果，我会帮你进一步排查！


